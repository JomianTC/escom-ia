const response = {
  "tramites": [
    {
      tramite: {
        "id": "8591b88c-cfe0-4231-9488-751335fdb529",
        nombre: 'Servicio Social',
        descripcion: ' <p style="font-size:18px; text-align:justify">Es un requisito indispensable para el proceso de titulación profesional. Se cubre al realizar actividades relacionadas con los conocimientos adquiridos en las aulas, talleres y laboratorios, por lo tanto, se considera como una retribución que hace el egresado a la sociedad que le dio la oportunidad de obtener una profesión. Los requisitos (tomados del Reglamento de Servicio Social del IPN) para prestar el Servicio Social dentro del Instituto Politécnico Nacional se enumeran a continuación:</p> <ul style="font-size:18px; text-align:justify"> <li><b>Artículo 7.</b> Por sus funciones y fines académicos, el servicio social estará desvinculado de cualquier relación de carácter laboral y no podrá otorgar categoría de trabajador al prestador bajo ninguna circunstancia, con excepción de lo señalado en el artículo 20 del presente <a href="https://www.aplicaciones.abogadogeneral.ipn.mx/PDFS/Normatividad/carpeta4/GAC_EXT_932B_reglamento_serv_social.pdf" target="_blank">Reglamento</a>.</li> <li><b>Artículo 11.</b> El servicio deberá prestarse dentro de los programas que al efecto se convengan con los sectores público, social y privado, así como los que establezca el propio instituto</li> <li><b>Artículo 13.</b> El servicio que se realice en programas intrainstitucionales será gratuito</li> <li><b>Artículo 14.</b> El servicio deberá prestarse durante un periodo mínimo de seis meses y máximo de dos años, quedando determinado el mismo por las características del programa al que este adscrito el prestador y su duración no podrá ser menor de cuatrocientas ochenta horas. La prestación será continua a efecto de que pueda cumplir sus objetivos</li> <li><b>Artículo 15.</b> El servicio que realicen los prestadores nacionales o extranjeros de los planteles deberá realizarse en el territorio de la República Mexicana, en beneficio de la sociedad y el estado mexicano</li></ul><b>Solicitud de constancia INDISPENSABLE al momento de realizar el registro:</b> <a href="https://forms.office.com/pages/responsepage.aspx?id=2fRL-ZeAlEet9qVGbKKFY-JLdN8w-KlBnYjodQmtWMpUQVNQMjdMQVFGNkY3RzdZVUZZUFlVTTVBWi4u">Link al Formulario</a> ',
        fechaInicio: '',
        fechaTermino: '',
        esInformativo: true,
        links: ["https://www.escom.ipn.mx/SSEIS/apoyoseducativos/docs/Registro_de_SS_presencial_dentro_de_la_ESCOM.JPG, Registro SS presencial", "https://www.escom.ipn.mx/SSEIS/apoyoseducativos/docs/Registro_de_SS_presencial_fuera_de_la_ESCOM.JPG, Registro SS a distancia"],
        estado: false
      },
      requerimientos: ["Boleta", "Varía dependiendo si es presencial o a distancia", "Constancia de Servicio Social", "Prestador asegurado"]
    },
    {
      "tramite": {
        "id": "8591b88c-cfe0-4231-9488-801335fdb529",
        "nombre": "Reportes Servicio Social SISS",
        "descripcion": "Recopilatorio de los documentos generales para subir a la plataforma del SISS. Mantente atento al llenado de los formatos y a la fecha de entrega de los mismos, recuerda que si es a distancia <b>NO LLEVAN FIRMAS</b>. Si estan consciente de que <b>no podrás cargar el reporte posterior a los 5 días despues de tu ultima fecha valida debes enviar un correo a  <a href='mailto:servicio_social_escom@ipn.mx'></a> </b>  ",
        "fechaInicio": "",
        "fechaTermino": "",
        estado: true,
        "esInformativo": true,
        "links": ['https://www.escom.ipn.mx/SSEIS/apoyoseducativos/docs/Formato_Reporte_Mensual.docx, Formato reporte mensual', "https://www.escom.ipn.mx/SSEIS/apoyoseducativos/docs/Formato_Reporte_Global.docx, Formato Reporte Global", "https://www.escom.ipn.mx/SSEIS/apoyoseducativos/docs/Reporte_de_Desempeno_o_Evaluacion.docx , Formato reporte de desempeno o evaluación", "https://www.escom.ipn.mx/SSEIS/apoyoseducativos/docs/Procedimiento_para_la_liberacion_del_servicio_social.pdf, Proceso liberación del servicio social", "https://www.escom.ipn.mx/SSEIS/apoyoseducativos/docs/Procedimiento_de_baja_de_servicio_social.pdf, ¿Problemas? Consulta como realizar la baja de tu servicio social"]
      },
      "requerimientos": [
        "Reportes por periodo",
        "Registro SISS autorizado"
      ]
    },
    {
      "tramite": {
        "id": "c4a1f727-04c7-47d2-b094-3f8221942588",
        "nombre": "Opciones de Prestatarios Servicio Social",
        "descripcion": "Enlace a lista de prestatarios disponible para realizar tu servicio social. Recuerda que debes de tener en cuenta la fecha de inicio y termino de tu servicio social, así como los requerimientos de cada prestatario. Si tienes dudas, acude a la oficina de Servicio Social de la ESCOM",
        "fechaInicio": "",
        "fechaTermino": "",
        estado: false,
        "esInformativo": true,
        "links": ["https://serviciosocial.ipn.mx/infoServSoc/InfoServSocListaPrsttrPerf.do?cvePerfil=36"]
      },
      "requerimientos": [
      ]
    },
    {
      "tramite": {
        "id": "8779b211-fbcb-466c-892f-4df581f680a5",
        "nombre": "Justificante Médico",
        "descripcion": "El siguiente formulario es únicamente para los alumnos de la Escuela Superior de Cómputo que deseen justificar su(s) falta(s) por medio de un soporte médico. NOTA: Si la fecha de la receta médica y las faltas que deseas justificar tienen más de una semana, NO PROCEDERÁ. **Las recetas médicas de servicio particular (que no sean expedidas por IMSS, ISSSTE u otro servicio médico público), deberán ser llevadas primero al servicio médico de la ESCOM con nombre, firma, sello y notas del médico para su validación y posteriormente anexarla a este formulario.** El horario deberá adjuntarse completo donde se incluya el (los) GRUPO(S), PROFESOR(ES) y DÍA (S) a justificar, de no ser así, no se elaborará el justificante. Una vez recibida la información, se elaborará el justificante y se enviará por correo a los profesores al correo institucional. Solamente nos pondremos en contacto contigo al correo que dejas de referencia, únicamente si hubiera alguna duda sobre la información proporcionada para la elaboración del mismo. SOLO SE ELABORARÁN JUSTIFICANTES POR CUESTIONES MÉDICAS (con soporte médico y validado por el servicio médico de ESCOM), ACADÉMICAS (que representes a la ESCOM o IPN en algún evento y con la invitación oficial como soporte) y POR CAUSAS DE FUERZA MAYOR (fallecimiento de familiar directo), NO SE REALIZAN JUSTIFICANTES POR CUESTIONES LABORALES Y/O PERSONALES, DEBERÁS CONSULTARLO CON EL O LOS DOCENTES Y ES A CONSIDERACIÓN DE CADA UNO.",
        "fechaInicio": "2024-02-01T06:00:00.000Z",
        "fechaTermino": "2024-03-22T06:00:00.000Z",
        estado: false,
        "esInformativo": true,
        "links": ["https://docs.google.com/forms/d/e/1FAIpQLSdA5w0hig1SviBkxWsH19wqd4wiqDpyD9bgy4fOANAkIuMHkw/viewform?embedded=true, Formulario de Justificante Médico"]
      },
      "requerimientos": [
        "Receta médica",
      ]
    }, {
      tramite: {
        id: "33a36fc7-5957-4071-96d6-7d2a0d3c8a2f",
        nombre: "Servicio Médico",
        descripcion: `El servicio médico de la ESCOM es un servicio gratuito para toda la comunidad politécnica. Se encuentra ubicado en el edificio de la ESCOM en el primer piso. El horario de atención es de 9:00 a 18:00 horas de lunes a viernes. Para poder ser atendido es necesario presentar tu credencial de estudiante. Si tienes alguna duda, acude a la oficina de Servicio Social de la ESCOM. <b>En los links odrás encontrar el formulatio de seguro de vida y accidentes</b> 
        Adicionalmente se adjuntan los telefonos de contacto de las personas encargadas del servicio médico:
        <ul>
          <li>Dra. Aideé Lizbeth Galván Zermeño | Dr Daniel Mauricio Temozihui Trejo : 57296000 Ext. 52014</li>
          <li>Dr Óscar Cortés Jiménez | Dr Cuauhtémoc García Hidalgo Trejo : 57296000 Ext. 52014</li>
        </ul>
        Algunos materiales Extra:
        <ul>
          <li><a href="https://www.escom.ipn.mx/SSEIS/serviciosestudiantiles/documentos/cartelServicioMedico.pdf">Seguro de Vida y Accidentes</a></li>
          <li><a href="https://www.escom.ipn.mx/SSEIS/serviciosestudiantiles/documentos/cartelServicioMedico.pdf">Seguro de Vida y Accidentes</a></li>
        </ul>
        `,
        fechaInicio: "",
        fechaTermino: "",
        estado: false,
        esInformativo: true,
        links: ["https://docs.google.com/forms/d/e/1FAIpQLSesltmSfnHYW-K4Yj5sLYJOfmjwweCHHLAJAJjX7bsvU86AKQ/viewform, Formulario de Seguro de Vida y Accidentes", "https://docs.google.com/forms/d/e/1FAIpQLSesltmSfnHYW-K4Yj5sLYJOfmjwweCHHLAJAJjX7bsvU86AKQ/viewform, Formulario de Seguro de Vida y Accidentes"]
      },
      requerimientos: []
    },
    {
      tramite: {
        id: 'd15dab7b96aef16438d5983ee58fa168',
        nombre: 'Biblioteca',
        descripcion: '<p class="ql-align-justify">En la biblioteca nuestro objetivo es facilitar a la comunidad de ESCOM el acceso a libros y bases de datos, a través de la Red Institucional de Bibliotecas y el uso de las tecnologías de la información y comunicación, con el fin de favorecer la generación del conocimiento y el desarrollo de la investigación científica y tecnológica.</p><p class="ql-align-justify"><br></p><p class="ql-align-justify">Te recomendamos realizar una lectura y revisión a detalle de los formatos de registro y renovación de servicios bibliotecarios</p><p><br></p>',
        fechaInicio: '2024-04-24T06:00:00.000Z',
        fechaTermino: '2024-04-25T06:00:00.000Z',
        esInformativo: true,
        links: [],
        estado: false
      },
      requerimientos: [ 'b51e40dab3a9b85f4f4c268bd67f4f48' ]
    }
  ],
  "total": 8
}
const crypto = require('crypto');
const waitTime = (wait) => new Promise((resolve) => setTimeout(resolve, wait));
const express = require('express');
const router = express.Router();
const COMMENTS = require('../data/Comments.json');
function checkHeaderToken (req, res, next) {
  const { authorization } = req.headers
  if (authorization.includes('Bearer') && authorization.includes('tony')) {
    next();
  } else {
    return res.status(403).json({ message: 'No tienes acceso' });
  }
}

router.get('/admin/findAll', async function (req, res, next) {
  const withNewIdData = response.tramites.map((tramite, index) => {
    tramite.tramite.id = crypto.randomBytes(16).toString('hex');
    return tramite;
  });
  await waitTime(1000);
  return res.status(200).json({ tramites: withNewIdData, total: withNewIdData.length });
});

router.get('/', async function (req, res, next) {
  const withNewIdData = response.tramites.map((tramite, index) => {
    tramite.tramite.id = crypto.randomBytes(16).toString('hex');
    return tramite;
  });
  await waitTime(1000);
  return res.status(200).json({ tramites: withNewIdData, total: withNewIdData.length });
});

router.post('/admin/:id', async function (req, res, next) {
  console.log(req.body);
  const { email } = req.body;
  const { id } = req.params;
  console.log(email , id);
  return res.status(200).json({ mensaje: 'El tramite ha sido eliminado', id });
 });

router.post('/', function (req, res, next) {
  const {id,
    nombre,
    descripcion,
    fechaInicio,
    fechaTermino,
    esInformativo,
    requerimentos,
    links,
    estado, } = req.body  
  const newTramite = {
    tramite:{
    id: crypto.randomBytes(16).toString('hex'),
    nombre,
    descripcion,
    fechaInicio,
    fechaTermino,
    esInformativo,
    links,
    estado
    },
    requerimientos : requerimentos
  }
  console.log(newTramite);
  response.tramites.push({...newTramite , estado : true})
  return res.json({
    mensaje: "Creado correctamente",
  })
})

router.put('/:id', function (req, res, next) {
  const {id,
    nombre,
    descripcion,
    fechaInicio,
    fechaTermino,
    esInformativo,
    requerimentos,
    links,
    estado = true, } = req.body
  const newTramite = {
    tramite:{
    id: req.params.id,
    nombre,
    descripcion,
    fechaInicio,
    fechaTermino,
    esInformativo,
    links,
    estado
    },
  
    requerimientos : requerimentos
  }

  response.tramites = response.tramites.map(tramite => {
    if (tramite.tramite.id === req.params.id) {
      return newTramite
    }
    return tramite
  })
  return res.json({
    mensaje: "Creado correctamente",
    id: req.params.id
  })
})

router.delete('/:id', function (req, res, next) {
  const { id } = req.params;
  console.log(id);
  const deletedTramiteIndex = response.tramites.findIndex(tramite => tramite.tramite.id === id);
  response.tramites[deletedTramiteIndex].tramite.estado = !response.tramites[deletedTramiteIndex].tramite.estado;
  return res.status(200).json({ mensaje: 'Tramite eliminado' });
})

module.exports = router;
